{% extends 'app/base.html' %}
{% block content %}
 
    <h1>Korisniƒçki dashboard</h1>

    <h2>User info</h2>
    <div>
        {% if not target_user == user %}
            <p><a href="/">Message User</a></p>
        {% endif %}
        <p>{{ target_user.name }}</p>
        <p>{{ target_user.email }}</p>
        <p>Token balance</p>
    </div>

    {% if postedJobs %}
        <h2>Posted Jobs</h2>
        {% for job in postedJobs %}
            <div>
                <p>{{ job.title }}</p> <br>
                <p>{{ job.description }}</p>
                <p>{{ job.source_launguage }}</p>
                <p>{{ job.target_language }}</p>
                <p>{{ job.get_field_display }}</p>
                <p>{{ job.budget }}</p>
                <p>{{ job.source_text }}</p>
                {% if job.translator %}
                    <p><a href="{% url 'accounts:user_dashboard' job.translator.id %}">{{job.translator}}</a></p>
                    {% for biddingOffer in biddingOffers %}
                        {% if biddingOffer.job == job and biddingOffer.translator == job.translator %}
                            <p>Accepted quote: {{biddingOffer.quote}}</p>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if not job.user == user and user.is_translator %}   
                    <p><a href="{% url 'app:job_bidding' job.id %}">Bid on Job</a></p>
                {% endif %}
                
                {% for biddingOffer in biddingOffers %}
                <div>

                    {% if biddingOffer.job == job %}
                        <p>Offer: {{biddingOffer.quote}} - <a href="{% url 'accounts:user_dashboard' biddingOffer.translator.id %}">{{biddingOffer.translator}}</a></p>
                        {% if job.user == user %}
                            <form method="post" action="{% url 'app:job_accept' job.id biddingOffer.id %}">
                                {% csrf_token %}
                                <input type="submit" value="Accept">  
                            </form>
                        {% endif %}
                    {% endif %}
                    
                </div>
                {% endfor %}
            
            </div>
            <br><br>

        {% endfor %}
    {% endif %}

    {% if user == target_user and assignedJobs %}
        <h2>Assigned Jobs</h2>
        {% for job in assignedJobs %}
                <p>{{ job.title }}</p> <br>
                <p>{{ job.description }}</p>
                <p>{{ job.source_launguage }}</p>
                <p>{{ job.target_language }}</p>
                <p>{{ job.get_field_display }}</p>
                <p>{{ job.budget }}</p>
                <p>{{ job.source_text }}</p>
                <a href="{% url 'app:complete_job' job.id %}">Complete job</a>
                    
        {% endfor %}
    {% endif %}


    {% if completedJobs %}
        <h2>Completed Jobs</h2>
        {% for job in completedJobs %}
                <p>{{ job.title }}</p> <br>
                <p>{{ job.description }}</p>
                <p>{{ job.source_launguage }}</p>
                <p>{{ job.target_language }}</p>
                <p>{{ job.get_field_display }}</p>
                <p>{{ job.budget }}</p>
                <p>{{ job.source_text }}</p>
                <p>{{ job.translated_text }}</p>
                
        {% endfor %}
    {% endif %}


{% endblock %}